* System Configuration

  Everything needed to build my NixOS system for play and Windows for work.

** Folder Structure

*** emacs

    My emacs configuration code. See its [[file:emacs/readme.org][readme]] for more information.

*** config

    Miscellaneous config files that are symlinked and managed with [[https://github.com/rycee/home-manager][home manager]].

*** nixos

    For Nix and NixOS related things.

*** win

    For things that are only used in Windows are kept here. See its [[file:win/readme.org][readme]] for
    more information.


* Keyboard Firmware - Planck layout

  The [[https://olkb.com/planck][Planck]] keyboard uses [[https://github.com/qmk/qmk_firmware/][qmk_firmware]] and I have my keymap code In the
  [[./nixos/keyboard-firmware/planck/]] folder. The following section describes my
  keyboard layout.

** Key aliases used below

 | Alias | Meaning         |
 |-------+-----------------|
 | ===== | column spacer   |
 | C     | Ctrl            |
 | S     | Shift           |
 | SPC   | Space           |
 | RET   | Return          |
 | GUI   | Win / Super key |
 | vert  | pipe character  |

 I use ~x/y~ to denote a key that does x when tapped and y when held. For
 example, ~RET/S~ performs return when tapped and shift when held.


** Qwerty

 | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|
 | Tab   | q     | w     | e     | r     | t     | y     | u     | i     | o     | p     | Bksp  |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|
 | Esc/C | a     | s     | d     | f     | g     | h     | j     | k     | l     | ;     | '     |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|
 | Shift | z     | x     | c     | v     | b     | n     | m     | ,     | .     | /     | RET/S |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|
 | Ctrl  | Num   | Super | Alt   | Lower | Hyper | SPC   | Raise | Alt   | GUI   |       | Ctrl  |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|


** Colemak Mod-DH

   https://colemakmods.github.io/mod-dh/

   I am using the ortho-linear variant of Colemak Mod-DH that switches the 'm'
   to the home row with the 'k' just below it. The reasoning is that 'm' is much
   more frequently used in English and easier to reach.

 | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|
 | Tab   | q     | w     | f     | p     | b     | j     | l     | u     | y     | ;     | Bksp  |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|
 | Esc/C | a     | r     | s     | t     | g     | m     | n     | e     | i     | o     | '     |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|
 | Shift | z     | x     | c     | d     | v     | k     | h     | ,     | .     | /     | RET/S |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|
 | Ctrl  | Num   | Super | Alt   | Lower | Hyper | SPC   | Raise | Alt   | GUI   |       | Ctrl  |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|


** Lower

 | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|
 |       | 1     | 2     | 3     | 4     | 5     | 6     | 7     | 8     | 9     | 0     |       |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|
 |       | ~     | (     | !     | =     | )     | {     | %     | &     | }     | \vert | Del   |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|
 |       |       | <     | >     |       |       |       |       |       |       |       |       |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|
 |       |       |       |       |       |       |       |       |       |       |       |       |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|


** Raise

 | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|
 |       | 1     | 2     | 3     | 4     | 5     | 6     | 7     | 8     | 9     | 0     |       |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|
 |       | `     | [     | +     | -     | ]     | ^     | *     | #     | $     | \     | Del   |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|
 |       |       | <     | >     | _     |       |       | @     |       |       |       |       |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|
 |       |       |       |       |       |       |       |       |       |       |       |       |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|


** Lower and Raise Commentary

   Number keys are present on both lower and raise layers to provide me the
   option to hold either layer for whatever is most comfortable.

   I have changed most of the positions of symbols. The following explains why:

   - Symbols on home row is great for programming and Vim/Evil

   - Positions in part motivated by higher frequency use being on the Lower
     layer since it is easier to delimit the symbol with spaces. I do not
     need to let go of the layer key to enter spaces when that layer key is on
     my left hand.

   - Symbols often used together kept on the same layer to avoid layer
     alternating.

   - Avoid covering ~Esc/C~ key so I have easy access to the ~Ctrl~ key.

   - Both raise and lower duplicate the ~<~ and ~>~ keys for easy access since
     these are often used in combination with other symbols. I still have these
     available in the normal positions.

   - Positions motivated by Evil symbol keys:

     I decided to mirror ~h~, ~j~, ~k~, ~l~ (Qwerty) style of Evil movement on
     the left hand with the same fingers since there are many things bound to
     symbols that have the notion of back/forward and up/down.

     Actually, the up and down positions on the left hand are mirrors of the
     right hand, but the left and right positions or spatially correct. It feels
     natural to me for the index finger to make things go down and the middle
     finger to make things go up. I used to hate these positions when I first
     started learning Vim because they weren't as natural as the ~w~, ~a~, ~s~,
     ~d~ keys. However, horizontal movement using ~h~ and ~l~ should be rare, if
     you're doing it right, and with that in mind down and up on the index and
     middle finger makes a lot of sense.

     + ~(~ and ~)~ which does back / forward a sentence in Evil bound to left /
       right positions on left hand.

     + ~{~ and ~}~ which does back / forward a paragraph in Evil bound to left /
       right positions on right hand.

     + ~[~ and ~]~ which does back / forward a section in Evil bound to left /
       right positions on left hand.

     + ~^~ and ~$~ which does a soft beginning of line / end of line in Evil
       bound to left / right positions on left hand.

     + ~+~ and ~-~ which are often associated with increasing and decreasing are
       bound to the up and down positions on the left hand.

     + ~*~ and ~#~ which does a word search forward / back in Evil bound to down
       and up positions on the right hand. I used that location because I'm out
       of left and right positions to use and searching forward/back often jumps
       down/up, which is close enough mentally for me.

     + ~!~ and ~=~ moved to home keys since their often used together and often
       used for negation.

     + ~|~ and ~\~ moved over a column to put it on the home keys. This allows
       ~Del~ to be moved below backspace, which make key combinations involving
       ~Del~ easier to hit.

     + =~= and ~`~ moved onto home keys. I mostly only used these with editing
       markdown and org files. The =~= key toggles case in Evil, but I tend to
       use ~u~ and ~U~ to do that in visual state. The ~`~ goes to a mark, which
       is useful and I'm happy with it's location.

     + ~@~ moved under right hand index finger. I often use this key along with
       ~q~ because both are involved with using Evil macros, which I use a lot.
       I initially thought to leave it close to ~q~, but double tapping ~@~ to
       replay the previous macro with my pinky finger would get old fast.

     + ~_~ has functionality in Evil I'm aware of, but never use. I only use it
       heavily when programming in Rust due to the typical snake case style. The
       primary reasoning behind it's location is to being close to ~-~ makes it
       easier to remember where it's at since they are visually similar.

     + ~%~ jumps to a matching symbol such as a parenthesis or braces. I put it
       on the down position key despite it's behavior not exactly matching that.
       However, it's close enough for me.

     + ~&~ repeats a substitute command in Evil, but I never use it. I might
       rebind this to ~evil-use-register~, which is typically on the quotation
       mark, because it's quite annoying to hold shift to hit it and then a
       layer to hit a number.


** Hyper

 | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|
 |       | F1    | F2    | F3    | F4    | F5    | F6    | F7    | F8    | F9    | F10   |       |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|
 |       |       | Home  | PgUp  | PgDn  | End   | Left  | Down  | Up    | Right | F11   |       |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|
 |       |       |       |       |       |       |       |       |       |       | F12   |       |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|
 |       |       |       |       |       |       |       |       |       |       |       |       |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|


** Num

   I just bind the normal key code for numbers instead of the number pad variant
   of it because I only use it for entering numbers and I never want to deal
   with number lock.

 | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|
 |       |       |       |       |       |       |       |     7 |     8 |     9 | -     |       |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|
 |       |       |       |       |       |       |       |     4 |     5 |     6 | +     |       |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|
 |       |       |       |       |       |       |       |     1 |     2 |     3 |       |       |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|
 |       |       |       |       |       |       |       |     0 |       |     . |       |       |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|


** Super

 | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|
 |       |       |       |       |       |       |       |       |       |       |       |       |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|
 |       |       |       |       |       |       |       |       |       |       |       |       |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|
 |       |       |       |       |       |       |       |       |       |       |       |       |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|
 |       |       |       |       |       |       |       |       |       |       |       |       |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|


** Plover layer

   http://opensteno.org

 | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== | ===== |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|
 |       | s     | t     | p     | h     | *     | *     | f     | p     | l     | t     | d     |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|
 |       | s     | k     | w     | r     | *     | *     | r     | b     | g     | s     | z     |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|
 | Exit  |       |       | a     | o     |       |       | e     | u     |       |       |       |
 |-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------|


** Adjust (Lower + Raise)

 |   | ====== | ====== | ====== | ====== | ====== | ====== | ====== | ====== | ====== |   |   |
 |---+--------+--------+--------+--------+--------+--------+--------+--------+--------+---+---|
 |   | Reset  |        |        |        |        |        |        |        |        |   |   |
 |---+--------+--------+--------+--------+--------+--------+--------+--------+--------+---+---|
 |   |        |        | Aud on | Audoff | AGnorm | AGswap | Qwerty | Colemk | Plover |   |   |
 |---+--------+--------+--------+--------+--------+--------+--------+--------+--------+---+---|
 |   | Voice- | Voice+ | Mus on | Musoff | MIDIon | MIDIof |        |        |        |   |   |
 |---+--------+--------+--------+--------+--------+--------+--------+--------+--------+---+---|
 |   |        |        |        |        |        |        |        |        |        |   |   |
 |---+--------+--------+--------+--------+--------+--------+--------+--------+--------+---+---|


* Hacking Evil keybindings

  Switching to Colemak keyboard layout has caused me to want to customize the
  Evil/Vim key bindings from their defaults. The main motivator is the spread
  out positions of ~h~, ~j~, ~k~, and ~l~ keys.

  Most people who use Evil with Colemak either get used to the new positions of
  things or use something like an [[https://colemakmods.github.io/ergonomic-mods/extend.html][extend layer]] to layer movement keys over the
  positions of said movement keys. The argument is that you shouldn't be using
  those keys much anyways because there are better approaches to movement. In
  addition, using a keyboard layer makes this movement available to all
  applications outside of editors and IDEs that provide Evil emulation.

  I find this argument unsatisfactory. I already use most of the better methods
  of movement, yet my usage of ~j~ and ~k~ remains quite high despite using ~{~,
  ~}~, ~(~, ~)~, ~C-u~, ~C-d~, and avy quite a lot. The letters ~h~ and ~l~ for
  horizontal movement I use less frequently due to my usage of ~f/F~ (find) and
  ~t/T~ (till) along with ~w~, ~b~, and ~e~.

  Turns out needing to up or down short distances is a common task, and a lot of
  the time I'm just perusing with no specific target or editing goal in mind. In
  addition, these keys often provide the semantic equivalent of movement key
  bindings in various packages that are not concerned with editing text.

  I haven't actually measured this, but I suspect the frequency of my usage of
  ~j~ and ~k~ is quite high. This is why I find the common solutions to Evil +
  Colemak unsatisfactory. The same drive to optimize things (and perhaps shave
  some Yaks) and learn Colemak is the same one that makes me want to fix this.

  Personally, I see the main downside to customizing Evil is the need to
  replicate the custom keybindings in anything else where I want to use it's Vim
  emulation. I think the Emacs package Tramp solves the issue with needing to
  ssh into a machine. And even without that, I typically have a user profile I
  could easily add a configuration file to.

  So now the question is how far do I take the customization. Even doing the
  minimal changes to get my Colemak Mod-DH (ortho-linear version) keys (~m~,
  ~n~, ~e~, ~i~) swapped with ~h~, ~j~, ~k~, and ~l~ will incur all the cons I
  mentioned above, so why not go all the way? Learning curve might be one reason
  to do a minimal fix. However, I personally don't have a problem investing the
  time to get over the learning curve for the sake of bindings that make more
  sense to me.


** How to read the tables below:

   I'm using [[http://www.viemu.com/vi-vim-cheat-sheet.gif][this cheat sheet]] to fill in the default bindings for Evil in an org
   table. The table below isn't meant to be a cheat sheet as many of the key are
   more nuanced than the description might lead one to believe. I'm overlaying
   the bindings onto my keymap for my Planck keyboard so I can easily ponder how
   to rearrange keys.

 - The table is split in half for the sake of not having to scroll horizontally.

 - The left most column named ~state~ describes modified states (i.e. holding
   Shift, Ctrl etc.), keyboard layers, and Evil states.

 - I use ~x/y~ to denote a key that does x when tapped and y when held. For
   example, ~RET/S~ performs return when tapped and shift when held.

   Aliases are used to keep from having tables that scroll horizontally:

  | Alias | Meaning           |
  |-------+-------------------|
  | #     | A number (0-9)    |
  | C     | Ctrl              |
  | GUI   | Win / Super key   |
  | M     | Alt / Meta        |
  | RET   | Return            |
  | S     | Shift             |
  | SPC   | Space             |
  | bol   | beginning of line |
  | del   | delete            |
  | eof   | end of file       |
  | eol   | end of line       |
  | ln    | line              |
  | mk    | mark              |
  | para  | paragraph         |
  | rec   | record            |
  | rev   | reverse           |
  | rpl   | replace           |
  | scrn  | screen            |
  | sent  | sentence          |
  | subst | substitute        |
  | tgl   | toggle            |
  | vis   | visual            |

** Custom Evil on ortho-linear Colemak-DH

*** Left half

**** Row 0

  | state   | col 0 | col 1        | col 2        | col 3           | col 4          | col 5        |
  |---------+-------+--------------+--------------+-----------------+----------------+--------------|
  | default | Tab   | q rec macro  | w next word  | f find          | p paste after  | b prev word  |
  | shift   |       | Q ex mode    | W next WORD  | F back find     | P paste before | B prev WORD  |
  | ======= | ===== | ============ | ===========  | =============== | ============== | ============ |
  | default | Esc/C | a append     | r rpl char   | s insert mode   | t till         | g extra cmds |
  | shift   |       | A append eol | R rpl mode   | S insert bol    | T back till    | G eof        |
  | lower   |       | ~ tgl case   | ( begin sent | ! ext filter    | =              | ) end sent   |
  | raise   |       | `            | [ prev sect  | +               | -              | ] next sect  |
  | ======= | ===== | ============ | ===========  | =============== | ============== | ============ |
  | default | Shift | z extra cmds | x del char   | c change        | d del          | v vis mode   |
  | shift   |       | Z quit       | X Bksp       | C change to eol | D del to eol   | V vis lines  |
  |---------+-------+--------------+--------------+-----------------+----------------+--------------|


*** Right half


  | layer   | col 6        | col 7         | col 8         | col 9        | col 10        | col 11 |
  |---------+--------------+---------------+---------------+--------------+---------------+--------|
  | default | j jump to mk | l end word    | u undo        | y yank       | ; repeat      | Bksp   |
  | shift   | J join ln    | L end WORD    | U redo        | Y tank ln    | : ex cmd line |        |
  | lower   | { begin para | % goto match  | & reg spec    | } end para   | \vert bol     | Del    |
  | raise   | ^ soft bol   | * next id     | # prev id     | $ eol        | \             | Del    |
  | ======= | ==========   | ============= | ===========   | =========    | ============= | =====  |
  | default | m left       | n down        | e up          | i right      | o open below  | '      |
  | shift   | M hard bol   | N scroll down | E scroll up   | I eol        | O open above  | "      |
  | Alt     | scrn mid     | scrn bot      | scrn top      |              |               |        |
  | raise   |              | @ play macro  |               |              |               |        |
  | ======= | ==========   | ============= | ===========   | =========    | ============= | =====  |
  | default | k set mk     | h next        | , rev t/T/f/F | . repeat cmd | / find        | RET/S  |
  | shift   | K            | H prev        | < un-indent   | > indent     | ? rev find    |        |
  |---------+--------------+---------------+---------------+--------------+---------------+--------|


*** Swapped key functionality

  | functionality | before | after |
  |---------------+--------+-------|
  | end WORD      | E      | L     |
  | end word      | e      | l     |
  | eol           | $      | I     |
  | hard bol      | 0      | M     |
  | insert bol    | I      | S     |
  | insert mode   | i      | s     |
  | next          | n      | h     |
  | prev          | N      | H     |
  | redo          | C-R    | U     |
  | scrn mid      | M      | M-m   |
  | scrn low      | L      | M-n   |
  | scrn top      | H      | M-e   |
  | scroll down   | C-d    | N     |
  | scroll up     | C-u    | E     |
  | set mk        | m      | k     |
  | jump to mk    | `      | j     |
  | subst line    | S      |       |
  | substitute    | s      |       |
  | undo line     | U      |       |
  | left          | h      | m     |
  | down          | j      | n     |
  | up            | k      | e     |
  | right         | l      | i     |
  | reg spec      | "      | &     |
